<!--
    MainWindow.xaml 是应用程序的主窗口界面定义文件
    
    XAML (eXtensible Application Markup Language) 是一种声明式的 UI 标记语言
    它让我们可以用类似 HTML 的方式来描述用户界面
    
    WPF 使用 MVVM (Model-View-ViewModel) 架构模式：
    - Model：数据模型（如 PlaylistGenerationRequest）
    - View：用户界面（这个 XAML 文件）
    - ViewModel：视图模型，连接 View 和 Model（MainWindowViewModel）
-->
<Window x:Class="PlaylistMaker.WPF.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:PlaylistMaker.WPF.ViewModels"
        mc:Ignorable="d"
        Title="播放列表工厂"
        Width="1100"
        Height="720"
        Icon="{DynamicResource AppWindowIcon}"
        Background="{DynamicResource BaseBackgroundBrush}"
        WindowStartupLocation="CenterScreen"
        d:DataContext="{d:DesignInstance vm:MainWindowViewModel, IsDesignTimeCreatable=False}">
    <!--
        Window 属性说明：
        - x:Class：指定对应的 C# 类
        - Title：窗口标题栏显示的文字
        - Width/Height：窗口的初始尺寸（像素）
        - Icon：窗口图标，显示在标题栏和任务栏
        - Background：窗口背景色，使用动态资源可以支持主题切换
        - WindowStartupLocation="CenterScreen"：窗口启动时居中显示
        - d:DataContext：设计时数据上下文，仅在设计器中有效，帮助智能提示
    -->
    
    <Window.Resources>
        <!--
            Window.Resources 是窗口级别的资源字典
            这里定义的资源只能在这个窗口内使用
        -->
        
        <!--
            BooleanToVisibilityConverter 是 WPF 内置的转换器
            它将 bool 值转换为 Visibility 枚举：
            - true → Visibility.Visible（显示）
            - false → Visibility.Collapsed（隐藏且不占空间）
        -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Window.Resources>
    
    <!--
        ScrollViewer 是滚动容器控件
        当内容超出可视区域时，会自动显示滚动条
        VerticalScrollBarVisibility="Auto" 表示只在需要时显示垂直滚动条
    -->
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <!--
            Grid 是 WPF 中最强大的布局容器
            它将区域划分为行和列，子元素可以放置在特定的单元格中
        -->
        <Grid Margin="24">
            <!--
                Grid.RowDefinitions 定义行的高度
                - Auto：根据内容自动调整高度
                - *：占用剩余空间（可以用 2* 表示占用两倍空间）
                - 固定值：如 100（像素）
            -->
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />  <!-- 第0行：标题区域 -->
                <RowDefinition Height="Auto" />  <!-- 第1行：配置区域 -->
                <RowDefinition Height="*" />     <!-- 第2行：日志区域，占用剩余空间 -->
            </Grid.RowDefinitions>

            <!-- 
                ============ 第一个卡片：标题和主题选择 ============
                Grid.Row="0" 表示放在第0行（默认值，可省略）
            -->
            <Border Style="{StaticResource SurfaceCardStyle}">
                <!--
                    StackPanel 是堆叠布局容器
                    子元素会按照 Orientation 方向依次排列
                    默认是 Vertical（垂直），也可以设为 Horizontal（水平）
                -->
                <StackPanel>
                    <!--
                        TextBlock 是文本显示控件，用于显示只读文本
                        常用属性：
                        - Text：显示的文字
                        - FontSize：字体大小（单位：像素或点）
                        - FontWeight：字体粗细（Normal, Bold, Light 等）
                        - Foreground：文字颜色
                    -->
                    <TextBlock Text="播放列表工厂 · 极致播放列表工厂体验"
                               FontSize="28"
                               FontWeight="Bold"
                               Foreground="{DynamicResource PrimaryForegroundBrush}" />
                    
                    <TextBlock Margin="0,6,0,0"
                               Text="资深产品经理联合定义的旗舰级播放列表构建体验，涵盖配置持久化、日志追踪与现代化界面。"
                               Foreground="{DynamicResource SecondaryForegroundBrush}"
                               TextWrapping="Wrap" />
                    <!-- TextWrapping="Wrap" 表示文字过长时自动换行 -->
                    
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="主题风格"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource SecondaryForegroundBrush}" />
                        
                        <!--
                            ComboBox 是下拉选择框控件
                            - ItemsSource：数据源，绑定到 ViewModel 的集合属性
                            - SelectedItem：选中的项，双向绑定
                            
                            {Binding PropertyName} 是数据绑定语法：
                            - Mode=TwoWay：双向绑定，UI 和数据源互相更新
                            - UpdateSourceTrigger=PropertyChanged：每次属性改变时立即更新
                        -->
                        <ComboBox Margin="12,0,0,0"
                                  ItemsSource="{Binding ThemeOptions}"
                                  SelectedItem="{Binding SelectedTheme, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  Width="180" />
                        
                        <!--
                            ProgressBar 是进度条控件
                            IsIndeterminate="True" 表示不确定进度，显示动画效果
                            Visibility 绑定到 IsBusy，通过转换器控制显示/隐藏
                        -->
                        <ProgressBar Margin="12,0,0,0"
                                     Width="160"
                                     Height="6"
                                     IsIndeterminate="True"
                                     Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- 
                ============ 第二个卡片：配置选项 ============
                Grid.Row="1" 表示放在第1行
            -->
            <Border Grid.Row="1" Style="{StaticResource SurfaceCardStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <!-- 两列等宽 -->
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- 第一行：文件夹选择和生成按钮，跨两列 -->
                    <Grid Grid.ColumnSpan="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        
                        <!--
                            TextBox 是文本输入框控件
                            Text 属性绑定到 ViewModel 的 FolderPath 属性
                            UpdateSourceTrigger=PropertyChanged 表示每次输入都会更新绑定源
                        -->
                        <TextBox Grid.Column="0"
                                 Margin="0,0,12,0"
                                 Text="{Binding FolderPath, UpdateSourceTrigger=PropertyChanged}" />
                        
                        <!--
                            Button 是按钮控件
                            Command 属性绑定到 ViewModel 的命令
                            命令模式是 MVVM 中处理用户交互的标准方式
                        -->
                        <Button Grid.Column="1"
                                Width="100"
                                Margin="0,0,12,0"
                                Content="浏览..."
                                Command="{Binding BrowseCommand}" />
                        
                        <Button Grid.Column="2"
                                Width="160"
                                Content="生成播放列表"
                                Command="{Binding GenerateCommand}"
                                Background="{DynamicResource AccentBrush}"
                                Foreground="White"
                                Padding="10,6" />
                    </Grid>

                    <!-- 第二行左侧：播放列表标题 -->
                    <StackPanel Grid.Row="1" Margin="0,16,24,0">
                        <TextBlock Text="播放列表标题" FontWeight="SemiBold" />
                        <TextBox Text="{Binding PlaylistTitle, UpdateSourceTrigger=PropertyChanged}" />
                    </StackPanel>

                    <!-- 第二行右侧：文件扩展名 -->
                    <StackPanel Grid.Row="1" Grid.Column="1" Margin="24,16,0,0">
                        <TextBlock Text="文件扩展名（分号/逗号分隔）" FontWeight="SemiBold" />
                        <TextBox Text="{Binding ExtensionsText, UpdateSourceTrigger=PropertyChanged}"
                                 ToolTip="示例：.mp3;.mp4;.wav" />
                        <!-- ToolTip 是鼠标悬停时显示的提示文字 -->
                    </StackPanel>

                    <!-- 第三行：复选框选项 -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,16,0,0">
                        <!--
                            CheckBox 是复选框控件
                            IsChecked 绑定到 bool 类型的属性
                        -->
                        <CheckBox Content="递归扫描子目录"
                                  IsChecked="{Binding IncludeSubdirectories, Mode=TwoWay}" />
                        <CheckBox Margin="24,0,0,0"
                                  Content="生成后自动打开"
                                  IsChecked="{Binding AutoOpenAfterExport, Mode=TwoWay}" />
                    </StackPanel>

                    <!-- 第四行：提示信息栏 -->
                    <Border Grid.Row="3" Grid.ColumnSpan="2" Margin="0,18,0,0" Padding="12"
                            Background="#144F46E5" CornerRadius="12">
                        <!-- #14 是约 8% 的透明度 -->
                        <TextBlock Text="所有偏好实时写入 Settings.settings，跨会话保留卓越体验。"
                                   Foreground="White" />
                    </Border>
                </Grid>
            </Border>

            <!-- 
                ============ 第三个卡片：实时日志 ============
                Grid.Row="2" 表示放在第2行
            -->
            <Border Grid.Row="2" Style="{StaticResource SurfaceCardStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!--
                        DockPanel 是停靠布局容器
                        子元素可以停靠在上、下、左、右四个方向
                        最后一个子元素会填充剩余空间
                    -->
                    <DockPanel>
                        <TextBlock Text="实时日志"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource PrimaryForegroundBrush}"
                                   DockPanel.Dock="Left" />
                        <Button Content="清空"
                                Command="{Binding ClearLogCommand}"
                                DockPanel.Dock="Right"
                                Padding="10,4" />
                    </DockPanel>

                    <!--
                        ListBox 是列表控件，用于显示项目集合
                        ItemsSource 绑定到 ObservableCollection
                        ObservableCollection 会在增删项目时自动通知 UI 更新
                    -->
                    <ListBox Grid.Row="1"
                             Margin="0,12,0,0"
                             ItemsSource="{Binding ActivityLog}">
                        <!--
                            ItemContainerStyle 定义每个列表项的样式
                        -->
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="6" />
                            </Style>
                        </ListBox.ItemContainerStyle>
                    </ListBox>
                </Grid>
            </Border>
        </Grid>
    </ScrollViewer>
</Window>
